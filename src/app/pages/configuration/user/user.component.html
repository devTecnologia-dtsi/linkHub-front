<div class="d-flex bd-highlight">
  <div class="me-auto bd-highlight">
    <button
      nzTooltipTitle="Agregar Usuario"
      nzTooltipPlacement="top"
      nz-button
      nzType="primary"
      (click)="openTemplate()"
      nz-tooltip
    >
      <span nz-icon nzType="plus">
        <span class="visually-hidden">Agregar</span>
      </span>
    </button>
  </div>
  <div class="bd-highlight">
    <div class="contenido">
      <nz-input-group nzSearch [nzAddOnAfter]="suffixButton">
        <input
          type="text"
          [(ngModel)]="searchValue"
          nz-input
          placeholder="buscar"
          id="buscar"
          name="buscar"
          class="input-transparente"
        />
        <label for="buscar" class="label-placeholder"> buscar </label>
      </nz-input-group>
    </div>
    <ng-template #suffixButton>
      <button nz-button nzType="primary" (click)="search()">
        <i nz-icon nzType="search"></i>Buscar
      </button>
    </ng-template>
  </div>
  <div class="bd-highlight">
    <button
      nzTooltipTitle="Limpiar busqueda"
      nzTooltipPlacement="top"
      nz-button
      nzType="primary"
      nz-tooltip
    >
      <span nz-icon nzType="clear" (click)="reset()">
        <span class="visually-hidden">Limpiar busqueda</span>
      </span>
    </button>
  </div>
</div>
<ng-template #drawerUser let-data let-drawerRef="drawerRef">
  <form
    nz-form
    [formGroup]="validateForm"
    (ngSubmit)="submitForm()"
    nzLayout="vertical"
  >
    <nz-form-item>
      <nz-form-label nzRequired nzFor="nombre">Nombre</nz-form-label>
      <nz-form-control nzErrorTip="Este campo es obligatorio">
        <input
          id="nombre"
          type="text"
          nz-input
          formControlName="nombre"
          [ngModel]="dataForm.nombre"
          placeholder="Escriba el nombre del usuario"
          [appLimitChars]="100"
        />
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzRequired nzFor="correo">Correo</nz-form-label>
      <nz-form-control nzErrorTip="Correo no valido">
        <input
          id="correo"
          type="text"
          nz-input
          formControlName="correo"
          [ngModel]="dataForm.correo"
          placeholder="Escriba el correo del usuario"
          [appLimitChars]="100"
        />
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzRequired nzFor="id_tipo_usuario">Rol</nz-form-label>
      <nz-form-control nzErrorTip="Este es un campo obligatorio">
        <nz-select
          id="id_tipo_usuario"
          formControlName="id_tipo_usuario"
          nzPlaceHolder="Seleciona el Rol"
          nzAllowClear
          nzShowSearch
          nzServerSearch
          [ngModel]="dataForm.id_tipo_usuario"
          (nzOnSearch)="onSearchTypeUser($event)"
        >
          <ng-container *ngFor="let dataEnviroment of optionListTypeUser">
            <nz-option
              *ngIf="!isLoadingTypeUser"
              [nzValue]="dataEnviroment.id"
              [nzLabel]="dataEnviroment.descripcion"
            ></nz-option>
          </ng-container>
          <nz-option *ngIf="isLoadingTypeUser" nzDisabled nzCustomContent>
            <span nz-icon nzType="loading" class="loading-icon"></span>
            Cargando informaci√≥n...
          </nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzRequired nzFor="cargo">Cargo</nz-form-label>
      <nz-form-control nzErrorTip="Este campo es obligatorio">
        <input
          id="cargo"
          type="text"
          nz-input
          formControlName="cargo"
          [ngModel]="dataForm.cargo"
          placeholder="Escriba el cargo del usuario"
          [appLimitChars]="100"
        />
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzRequired nzFor="telefono">Telefono</nz-form-label>
      <nz-form-control nzErrorTip="Este campo es obligatorio">
        <input
          id="telefono"
          type="text"
          nz-input
          formControlName="telefono"
          [ngModel]="dataForm.telefono"
          placeholder="Escriba el telefono del usuario"
          [appLimitChars]="20"
          type="number"
        />
      </nz-form-control>
    </nz-form-item>
  </form>
</ng-template>
<ng-template #footerUser>
  <div style="float: right">
    <button class="me-2" nz-button (click)="close()">Cerrar</button>
    <button
      nz-button
      nzType="primary"
      (click)="submitForm()"
      [nzLoading]="isSaving"
    >
      Guardar
    </button>
  </div>
</ng-template>
<nz-table
  class="mt-2"
  #filterTable
  [nzData]="listOfData"
  nzTableLayout="fixed"
  [nzPageSize]="100"
  [nzScroll]="{ x: 'auto' }"
  [nzLoading]="isLoading"
>
  <thead>
    <tr>
      <th
        *ngFor="let column of listOfColumns"
        [(nzSortOrder)]="column.sortOrder"
        [nzSortFn]="column.sortFn"
        [nzShowSort]="column.showSort"
        nzWidth="150px"
      >
        {{ column.name }}
      </th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let data of filterTable.data">
      <td>{{ data.id }}</td>
      <td>{{ data.nombre }}</td>
      <td>{{ data.correo }}</td>
      <td>{{ data.descripcion_tipo_usuario }}</td>
      <td>{{ data.cargo }}</td>
      <td>{{ data.telefono }}</td>
      <td>
        <div class="d-flex justify-content-evenly">
          <button
            nzTooltipTitle="Editar"
            nzTooltipPlacement="top"
            nz-button
            nzType="primary"
            nz-tooltip
          >
            <span nz-icon nzType="edit" (click)="openEditTemplate(data)">
              <span class="visually-hidden">Editar</span>
            </span>
          </button>
          @if (!data.loading){
          <label
            [nzId]="data.id"
            nz-checkbox
            [(ngModel)]="data.activo"
            nz-tooltip
            [nzTooltipTitle]="data.activo ? 'Desactivar' : 'Activar'"
            nzTooltipPlacement="top"
            (ngModelChange)="changeState(data)"
          >
            <span class="visually-hidden">Activar | Desactivar</span>
          </label>
          }@else {
          <button nz-button nzLoading nzType="dashed" nzShape="circle"></button>
          }
        </div>
      </td>
    </tr>
  </tbody>
</nz-table>
